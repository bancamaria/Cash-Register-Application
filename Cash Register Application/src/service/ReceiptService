package service;
import model.Coupons;
import model.Receipt;
import repositories.ReceiptRepository;

import java.util.Set;

public class ReceiptService {
    private static ReceiptService instance;
    private ReceiptRepository receiptRepository;

    private ReceiptService() {
        receiptRepository = new ReceiptRepository();
    }

    public static ReceiptService getInstance() {
        if (instance == null)
            instance = new ReceiptService();
        return instance;
    }

    public Set<Receipt> getReceipts() {
        return receiptRepository.getReceipts();
    }

    public boolean addReceipt(Receipt r) {
        if (RegisterService.getInstance().getRegisterById(r.getRegisterId()) == null)
            return false;
        if (r.getCashierId() != -1 && CashierService.getInstance().getCashierById(r.getCashierId()) == null)
            return false;
        if (r.getCouponId() != -1) {
            Coupon c = CouponService.getInstance().getCouponById(r.getCouponId());
            if (c == null)
                return false;
            if (c.isUsed())
                return false;
            c.setUsed(true);
        }
        return receiptRepository.add(r);
    }

    public boolean removeReceipt(int id) {
        return receiptRepository.remove(id);
    }

    public Receipt getReceiptById(int id) {
        return receiptRepository.getReceiptById(id);
    }

    public Set<Receipt> getReceiptsByRegisterId(int registerId) {
        return receiptRepository.getReceiptsByRegisterId(registerId);
    }

    public Set<Receipt> getReceiptsByCashierId(int cashierId) {
        return receiptRepository.getReceiptsByCashierId(cashierId);
    }

    public Receipt getReceiptByCouponId(int id) {
        return receiptRepository.getReceiptByCouponId(id);
    }
}